(function(f,d){function g(b,a){typeof b==="string"&&(b=[b]);this.callback=a;this.numProcessed=this.numAborts=this.numErrors=this.numLoaded=0;this.numImages=b.length;this.images=[];for(var c=0,c=0;c<b.length;c++)this.preload(b[c])}f.fn.spritezoom=function(b){if(h[b])return h[b].apply(this,Array.prototype.slice.call(arguments,1));else if(typeof b==="object"||!b)return h.init.apply(this,arguments);else f.error("Method "+b+" does not exist on jQuery.spritezoom")};var h={init:function(b){var a={fadeInSpeed:500,
fadeOutSpeed:300,behavior:"standard",viewLayer:{layerElement:null,imageElement:null,imageUrl:d,imageWidth:d,imageHeight:d,opacity:1,fadeInSpeed:d,fadeOutSpeed:d,css:{border:"4px solid #ccc",overflow:"hidden"}},tintLayer:{layerElement:null,opacity:0.5,fadeInSpeed:d,fadeOutSpeed:d,css:{background:"#888","background-position":"2px 2px","background-repeat":"no-repeat"}},zoomLayer:{layerElement:null,imageElement:null,imageUrl:d,imageWidth:d,imageHeight:d,opacity:1,fadeInSpeed:d,fadeOutSpeed:d,css:{border:"4px solid #ccc",
margin:"-4px"},layout:"right",layoutOffset:{top:0,left:16}},lensLayer:{layerElement:null,imageElement:null,imageUrl:d,imageWidth:d,imageHeight:d,opacity:1,fadeInSpeed:d,fadeOutSpeed:d,css:{overflow:"hidden",border:"4px solid #888",margin:"-4px",cursor:"move"},offset:d},mouseLayer:{layerElement:null}},b=b||{};f.extend(!0,a,b);return this.each(function(){var c=f(this),d=c.data("spritezoom");if(d)f.extend(!0,d.settings,b);else{c.attr("unselectable","on");if(c.is("a")&&c.children().first().is("img"))a.viewLayer.imageUrl=
c.children().first().attr("src"),a.zoomLayer.imageUrl=c.attr("href"),c.click(function(){return!1});if(!a.lensLayer.imageUrl)a.lensLayer.imageUrl=a.viewLayer.imageUrl;c.html("");a.viewLayer.layerElement=f("<div class='spritezoom-view'> <img src='"+a.viewLayer.imageUrl+"'/> </div");a.viewLayer.imageElement=a.viewLayer.layerElement.find("img");c.append(a.viewLayer.layerElement);a.tintLayer.layerElement=f("<div class='spritezoom-tint'></div");c.append(a.tintLayer.layerElement);a.tintLayer.layerElement.hide();
if(!a.zoomLayer.layerElement)a.zoomLayer.layerElement=f("<div class='spritezoom-zoom'></div>"),c.append(a.zoomLayer.layerElement);a.zoomLayer.layerElement.find("img").length===0&&a.zoomLayer.layerElement.append("<img src='"+a.zoomLayer.imageUrl+"'/>");a.zoomLayer.imageElement=a.zoomLayer.layerElement.find("img");a.zoomLayer.layerElement.hide();a.lensLayer.layerElement=f("<div class='spritezoom-lens'> <img src='"+a.lensLayer.imageUrl+"'/> </div");a.lensLayer.imageElement=a.lensLayer.layerElement.find("img");
c.append(a.lensLayer.layerElement);a.lensLayer.layerElement.hide();a.mouseLayer.layerElement=f("<div class='spritezoom-mouse'/>");c.append(a.mouseLayer.layerElement);a.viewLayer.layerElement.css(a.viewLayer.css);a.zoomLayer.layerElement.css(a.zoomLayer.css);a.tintLayer.layerElement.css(a.tintLayer.css);a.lensLayer.layerElement.css(a.lensLayer.css);c.data("spritezoom",{target:c,settings:a,touchable:/iphone|ipod|ipad|android/i.test(navigator.userAgent)});d=c.data("spritezoom");e.reconfiger(c,d)}})},
destroy:function(){return this.each(function(){var b=f(this);data=b.data("spritezoom");b.unbind(".spritezoom");b.removeData("spritezoom")})},update:function(){return this.each(function(){var b=f(this);data=b.data("spritezoom");e.updateBackground(b,data)})},showLayer:function(b){data=f(this).data("spritezoom");for(i=0;i<b.length;i++)if(options=e.getLayerOptions(b[i],data),options.layerElement&&!options.layerIsVisible)options.layerElement.fadeTo(options.fadeInSpeed||data.settings.fadeInSpeed,options.opacity),
options.layerIsHidden=!1,options.layerIsVisible=!0},hideLayer:function(b){data=f(this).data("spritezoom");for(i=0;i<b.length;i++)if(options=e.getLayerOptions(b[i],data),options.layerElement&&!options.layerIsHidden)options.layerElement.fadeOut(options.fadeOutSpeed||data.settings.fadeOutSpeed),options.layerIsHidden=!0,options.layerIsVisible=!1}},e={prevent:function(b){b.cancelable&&b.preventDefault();return!1},eventDelegate:function(b){var a=f(this).parent(),c=a.data("spritezoom"),d=c.settings.behavior;
typeof c.settings.behavior==="string"&&(d=j[c.settings.behavior]);d[b.type].apply(a,[b,a,c]);return!0},storePoints:function(b,a){if(b.touches===d&&b.originalEvent!==d)b.touches=b.originalEvent.touches;b.touches!==d&&b.touches.length>0?(a.currentX=b.touches[0].pageX,a.currentY=b.touches[0].pageY):(a.currentX=b.pageX,a.currentY=b.pageY);offset=a.settings.viewLayer.imageElement.offset();a.targetX=a.currentX-offset.left;a.targetY=a.currentY-offset.top;if(a.focusX===d)a.focusX=a.targetX;if(a.focusY===
d)a.focusY=a.targetY;a.focusX=a.targetX;a.focusY=a.targetY;return!1},resetPoints:function(b,a){a.currentX=d;a.currentY=d;a.targetX=d;a.targetY=d;a.focusX=d;a.focusY=d},getLayerOptions:function(b,a){switch(b){case "view":return a.settings.viewLayer;case "zoom":return a.settings.zoomLayer;case "tint":return a.settings.tintLayer;case "lens":return a.settings.lensLayer}return{}},cacheImageSize:function(b,a){options=e.getLayerOptions(b,a);if(options.imageElement)options.imageWidth=options.imageElement.innerWidth(),
options.imageHeight=options.imageElement.innerHeight()},cacheLayerSize:function(b,a){options=e.getLayerOptions(b,a);if(options.layerElement)options.layerWidth=options.layerElement.innerWidth(),options.layerHeight=options.layerElement.innerHeight()},cacheImageSizes:function(b,a){for(var c=0,c=0;c<a.length;c++)e.cacheImageSize(a[c],b)},cacheLayerSizes:function(b,a){for(var c=0,c=0;c<a.length;c++)e.cacheLayerSize(a[c],b)},clamp:function(b,a,c){if(b<a)return a;if(b>c)return c;return b},wrapValue:function(b,
a,c){for(;b>=c;)b-=c;for(;b<a;)b+=c;return b},reconfiger:function(b,a){e.preloadImages(b,a,function(){a.settings.zoomLayer.layerElement.show();a.settings.tintLayer.layerElement.show();a.settings.lensLayer.layerElement.show();e.cacheImageSizes(a,["view","tint","zoom","lens"]);e.initializeBackground(b,a);e.cacheLayerSizes(a,["view","tint","zoom","lens"]);a.settings.zoomLayer.layerElement.hide();a.settings.tintLayer.layerElement.hide();a.settings.lensLayer.layerElement.hide();e.updateBackground(b,a);
e.rebindEvents(b,a);b.trigger("onLoad",a)})},initializeBackground:function(b,a){view=a.settings.viewLayer;zoom=a.settings.zoomLayer;lens=a.settings.lensLayer;reference=a.settings.viewLayer;offset=reference.imageElement.offset();a.settings.viewLayer.layerElement.css({width:reference.imageWidth,height:reference.imageHeight,overflow:"hidden"});a.settings.tintLayer.layerElement.css({position:"absolute",left:offset.left,top:offset.top,width:reference.imageWidth,height:reference.imageHeight});zoomCss={};
if(typeof a.settings.zoomLayer.layout==="function")zoomCss=a.settings.zoomLayer.layout.apply(b,[b,a]);else switch(a.settings.zoomLayer.layout){case "inner":zoomCss={position:"absolute",top:offset.top,left:offset.left,width:reference.imageWidth,height:reference.imageHeight};break;case "right":zoomCss={position:"absolute",top:offset.top,left:offset.left+reference.imageWidth,width:reference.imageWidth,height:reference.imageHeight};break;case "top":zoomCss={position:"absolute",top:offset.top-reference.imageHeight,
left:offset.left,width:reference.imageWidth,height:reference.imageHeight};break;case "top":zoomCss={position:"absolute",top:offset.top,left:offset.left-reference.imageWidth,width:reference.imageWidth,height:reference.imageHeight};break;case "bottom":zoomCss={position:"absolute",top:offset.top+reference.imageHeight,left:offset.left,width:reference.imageWidth,height:reference.imageHeight}}zoomCss.top+=a.settings.zoomLayer.layoutOffset.top;zoomCss.left+=a.settings.zoomLayer.layoutOffset.left;f.extend(zoomCss,
{overflow:"hidden"});a.settings.zoomLayer.layerElement.css(zoomCss);(lens.css.width===d||lens.css.height===d)&&lens.layerElement.css({width:view.imageWidth*(view.imageWidth/zoom.imageWidth),height:view.imageHeight*(view.imageHeight/zoom.imageHeight)});b.css({width:reference.imageWidth,height:reference.imageHeight,overflow:"visible"});a.settings.mouseLayer.layerElement.css({position:"absolute",top:offset.top,left:offset.left,width:reference.imageWidth,height:reference.imageHeight})},updateBackground:function(b,
a){view=a.settings.viewLayer;zoom=a.settings.zoomLayer;lens=a.settings.lensLayer;focusX=a.focusX||0;focusY=a.focusY||0;scaleX=zoom.imageWidth/view.imageWidth;scaleY=zoom.imageHeight/view.imageHeight;x=zoom.layerWidth/2-focusX*scaleX;y=zoom.layerHeight/2-focusY*scaleY;x=e.clamp(x,zoom.layerWidth-zoom.imageWidth,0);y=e.clamp(y,zoom.layerHeight-zoom.imageHeight,0);zoom.imageElement.css({position:"relative",top:y,left:x});offset=view.imageElement.offset();lensX=a.currentX-lens.layerWidth/2;lensY=a.currentY-
lens.layerHeight/2;switch(typeof lens.offset){case "object":lensX=a.currentX+lens.offset.left;lensY=a.currentY+lens.offset.top;break;case "function":result=lens.offset.apply(b,[b,a]),lensX=a.currentX+result.left,lensY=a.currentY+result.top}lensX=e.clamp(lensX,offset.left,offset.left+view.layerWidth-lens.layerWidth);lensY=e.clamp(lensY,offset.top,offset.top+view.layerHeight-lens.layerHeight);lens.layerElement.css({position:"absolute",top:lensY,left:lensX});scaleX=lens.imageWidth/view.imageWidth;scaleY=
lens.imageHeight/view.imageHeight;x=lens.layerWidth/2-focusX*scaleX;y=lens.layerHeight/2-focusY*scaleY;x=e.clamp(x,lens.layerWidth-lens.imageWidth,0);y=e.clamp(y,lens.layerHeight-lens.imageHeight,0);lens.imageElement.css({position:"relative",top:y,left:x})},rebindEvents:function(b,a){eventReceiver=a.settings.mouseLayer.layerElement;b.unbind(".spritezoom");eventReceiver.unbind(".spritezoom");b.bind("mousemove.spritezoom",function(a){e.storePoints(a,b.data("spritezoom"))});eventReceiver.bind("mousedown.spritezoom",
e.eventDelegate);eventReceiver.bind("mousemove.spritezoom",e.eventDelegate);eventReceiver.bind("mouseup.spritezoom",e.eventDelegate);eventReceiver.bind("mouseenter.spritezoom",e.eventDelegate);eventReceiver.bind("mouseover.spritezoom",e.eventDelegate);eventReceiver.bind("mouseleave.spritezoom",e.eventDelegate);eventReceiver.bind("dblclick.spritezoom",e.eventDelegate);a.touchable&&(eventReceiver.bind("touchstart.spritezoom",e.eventDelegate),eventReceiver.bind("touchmove.spritezoom",e.eventDelegate),
eventReceiver.bind("touchend.spritezoom",e.eventDelegate),eventReceiver.bind("touchcancel.spritezoom",e.eventDelegate),eventReceiver.bind("click.spritezoom",e.prevent),eventReceiver.bind("gesturestart.spritezoom",e.prevent),eventReceiver.bind("gesturechange.spritezoom",e.prevent),eventReceiver.bind("gestureend.spritezoom",e.prevent));b.bind("mousedown.spritezoom selectstart.spritezoom",e.prevent);a.settings.onLoad!==d&&b.bind("onLoad.spritezoom",a.settings.onLoad)},preloadImages:function(b,a,c){var d=
f('<div class="spritezoom-preload"/>');b.find(".spritezoom-preload").length===0&&b.append(d);cleanup=function(){b.find(".spritezoom-preload").fadeOut(a.settings.fadeInSpeed||250,function(){f(this).detach()});c.apply(b,[a])};d.css({position:"absolute",top:a.settings.viewLayer.layerElement.offset().top,left:a.settings.viewLayer.layerElement.offset().left,width:a.settings.viewLayer.layerElement.outerWidth(),height:a.settings.viewLayer.layerElement.outerHeight()});d.css(a.settings.preloadCss||{});d.hide().html(a.settings.preloadHtml||
" ").fadeIn(a.settings.fadeOutSpeed||250,function(){new g([a.settings.viewLayer.imageUrl,a.settings.zoomLayer.imageUrl],cleanup)})}};g.prototype.preload=function(b){var a=new Image;this.images.push(a);a.onload=g.prototype.onload;a.onerror=g.prototype.onerror;a.onabort=g.prototype.onabort;a.preloader=this;a.src=b};g.prototype.onProcessed=function(){this.numProcessed++;this.numProcessed===this.numImages&&this.callback(this.images,this.numLoaded)};g.prototype.onload=function(){this.preloader.numLoaded++;
this.preloader.onProcessed()};g.prototype.onerror=function(){this.preloader.numErrors++;this.preloader.onProcessed()};g.prototype.onabort=function(){this.preloader.numAborts++;this.preloader.onProcessed()};var j={none:{mousedown:function(){return!1},mousemove:function(){return!1},mouseup:function(){return!1},mouseenter:function(){return!1},mouseover:function(){return!1},mouseleave:function(){return!1},dblclick:function(){return!1}},standard:{mousedown:function(){return!1},mousemove:function(b,a){a.spritezoom("showLayer",
["view","tint","zoom","lens"]);a.spritezoom("update");return!1},mouseup:function(){return!1},mouseenter:function(b,a){a.spritezoom("update");return!1},mouseover:function(){return!1},mouseleave:function(b,a){a.spritezoom("hideLayer",["tint","zoom","lens"]);a.spritezoom("update");return!1},dblclick:function(){return!1}},clickZoom:{mousedown:function(b,a){a.spritezoom("showLayer",["view","tint","zoom","lens"]);a.spritezoom("update");return!1},mousemove:function(b,a){a.spritezoom("update");return!1},
mouseup:function(b,a){a.spritezoom("hideLayer",["tint","zoom","lens"]);a.spritezoom("update");return!1},mouseenter:function(b,a){a.spritezoom("update");return!1},mouseover:function(){return!1},mouseleave:function(b,a){a.spritezoom("hideLayer",["tint","zoom","lens"]);a.spritezoom("update");return!1},dblclick:function(){return!1}}}})(jQuery);